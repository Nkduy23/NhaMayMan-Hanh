<!DOCTYPE html>
<html lang="vi">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Ho√†n t·∫•t ·ªßng h·ªô - H·∫†NH</title>
      <script src="https://cdn.tailwindcss.com"></script>
      <link
         href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
         rel="stylesheet"
      />
      <style>
         body {
            font-family: "Inter", sans-serif;
         }
      </style>
   </head>
   <body class="bg-gray-50 min-h-screen">
      <!-- Header -->
      <header></header>

      <!-- Main -->
      <main class="max-w-4xl mx-auto px-4 py-8">
         <div class="bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-3xl font-bold text-green-600 mb-6 text-center">
               Ho√†n t·∫•t ·ªßng h·ªô
            </h1>
            <p class="text-center text-gray-600 mb-8">
               M·ªói s·∫£n ph·∫©m l√† m·ªôt h√†nh ƒë·ªông y√™u th∆∞∆°ng üíú
            </p>

            <!-- Form th√¥ng tin -->
            <form id="checkout-form" class="space-y-6 mb-8">
               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                     >H·ªç v√† t√™n *</label
                  >
                  <input
                     type="text"
                     required
                     class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                     placeholder="Nguy·ªÖn VƒÉn A"
                  />
               </div>

               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                     >S·ªë ƒëi·ªán tho·∫°i *</label
                  >
                  <input
                     type="tel"
                     required
                     pattern="[0-9]{10}"
                     class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                     placeholder="0901234567"
                  />
               </div>

               <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1"
                     >ƒê·ªãa ch·ªâ nh·∫≠n h√†ng *</label
                  >
                  <textarea
                     required
                     rows="3"
                     class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                     placeholder="S·ªë nh√†, ƒë∆∞·ªùng, ph∆∞·ªùng/x√£, qu·∫≠n/huy·ªán, t·ªânh/th√†nh"
                  ></textarea>
               </div>
            </form>

            <!-- T·ªïng k·∫øt gi·ªè h√†ng -->
            <div id="checkout-summary" class="bg-gray-50 p-6 rounded-lg mb-6">
               <p class="text-center text-gray-500">ƒêang t·∫£i gi·ªè h√†ng...</p>
            </div>

            <!-- N√∫t x√°c nh·∫≠n -->
            <button
               id="confirm-btn"
               class="w-full bg-purple-600 text-white py-3 rounded-lg font-medium hover:bg-purple-700 transition text-lg"
            >
               X√ÅC NH·∫¨N ·ª¶NG H·ªò
            </button>

            <!-- Modal c·∫£m ∆°n -->
            <div
               id="thankyou-modal"
               class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
            >
               <div
                  class="bg-white rounded-lg p-8 max-w-md w-full text-center animate-fade"
               >
                  <svg
                     class="w-16 h-16 text-green-500 mx-auto mb-4"
                     fill="none"
                     stroke="currentColor"
                     viewBox="0 0 24 24"
                  >
                     <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                     ></path>
                  </svg>
                  <h2 class="text-2xl font-bold text-green-600 mb-2">
                     C·∫£m ∆°n b·∫°n!
                  </h2>
                  <p class="text-gray-600 mb-4">
                     ƒê∆°n ·ªßng h·ªô ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n. Ch√∫ng t√¥i s·∫Ω li√™n h·ªá s·ªõm üíö
                  </p>
                  <a
                     href="../index.html"
                     class="bg-purple-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-purple-700"
                  >
                     V·ªÅ trang ch·ªß
                  </a>
               </div>
            </div>
         </div>
      </main>

      <script type="module">
         import { products } from "../assets/data/products-home/products.js";

         const cart = JSON.parse(localStorage.getItem("cart")) || [];
         const summaryEl = document.getElementById("checkout-summary");
         const form = document.getElementById("checkout-form");
         const confirmBtn = document.getElementById("confirm-btn");
         const modal = document.getElementById("thankyou-modal");

         // ƒê·ªãnh d·∫°ng ti·ªÅn
         const formatPrice = (n) => n.toLocaleString("vi-VN") + " ‚Ç´";

         // Render gi·ªè h√†ng
         function renderSummary() {
            if (cart.length === 0) {
               summaryEl.innerHTML = `<p class="text-center text-red-500">Gi·ªè h√†ng tr·ªëng!</p>`;
               confirmBtn.disabled = true;
               confirmBtn.classList.add("opacity-50", "cursor-not-allowed");
               return;
            }

            let html = `<h3 class="font-bold mb-3 text-lg">Chi ti·∫øt ·ªßng h·ªô:</h3><ul class="divide-y">`;
            let total = 0;

            cart.forEach((item) => {
               const p = products[item.category]?.find((x) => x.id === item.id);
               if (p) {
                  const amount = p.price_range * item.qty;
                  total += amount;
                  html += `
            <li class="flex justify-between py-2 text-sm items-center">
              <div>
                <span class="font-medium">${p.product_name}</span>
                <span class="text-gray-500"> √ó ${item.qty}</span>
                ${
                   item.size
                      ? `<div class="text-gray-400 text-xs">Size: ${item.size}</div>`
                      : ""
                }
              </div>
              <span class="font-semibold">${formatPrice(amount)}</span>
            </li>
          `;
               }
            });

            html += `</ul>
      <div class="mt-4 pt-3 border-t font-bold text-lg flex justify-between">
        <span>T·ªîNG C·ªòNG</span>
        <span class="text-purple-600">${formatPrice(total)}</span>
      </div>`;

            summaryEl.innerHTML = html;
         }

         // X·ª≠ l√Ω x√°c nh·∫≠n
         confirmBtn.addEventListener("click", () => {
            if (!form.checkValidity()) {
               form.reportValidity();
               return;
            }

            const name = form.querySelector('input[type="text"]').value.trim();
            const phone = form.querySelector('input[type="tel"]').value.trim();
            const address = form.querySelector("textarea").value.trim();

            // Hi·ªÉn th·ªã modal c·∫£m ∆°n
            modal.classList.remove("hidden");

            // X√≥a gi·ªè h√†ng
            localStorage.removeItem("cart");

            // (T√πy ch·ªçn) G·ª≠i d·ªØ li·ªáu v·ªÅ server ·ªü ƒë√¢y
            const orderData = {
               name,
               phone,
               address,
               cart,
               total: cart.reduce((sum, i) => {
                  const p = products[i.category]?.find((x) => x.id === i.id);
                  return sum + (p ? p.price_range * i.qty : 0);
               }, 0),
            };
            console.log("ƒê∆°n ·ªßng h·ªô:", orderData);
         });

         // Kh·ªüi ƒë·ªông
         renderSummary();
      </script>

      <footer></footer>
      <script src="assets/js/layout.js"></script>
   </body>
</html>
