<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link
         rel="stylesheet"
         href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
      />
      <title>Trang chủ</title>
      <link
         rel="icon"
         type="image/png"
         sizes="192x192"
         href="assets/favicon/android-icon-192x192.png"
      />
      <link rel="stylesheet" href="assets/css/style.css" />
      <link rel="stylesheet" href="assets/css/home.css" />
      <link rel="stylesheet" href="assets/css/box-product.css" />
   </head>
   <body>
      <header></header>
      <section class="hero">
         <div class="slider-container">
            <div class="slide active">
               <img src="assets/img/banner/banner-01.jpg" alt="Banner 1" />
            </div>
            <div class="slide">
               <img src="assets/img/banner/banner-02.jpg" alt="Banner 2" />
            </div>
            <div class="slide">
               <img src="assets/img/banner/banner-03.jpg" alt="Banner 3" />
            </div>
         </div>
         <button class="slider-arrow prev">‹</button>
         <button class="slider-arrow next">›</button>
         <div class="slider-nav">
            <span class="slider-dot active" data-slide="0"></span>
            <span class="slider-dot" data-slide="1"></span>
            <span class="slider-dot" data-slide="2"></span>
         </div>
      </section>
      <main class="home">
         <div class="product-listing-container">
            <div class="header-section">
               <h2 class="title">Sản phẩm may</h2>
            </div>
            <div class="product-grid"></div>
         </div>
         <div class="product-canva-container">
            <div class="header-section">
               <h2 class="title">Sản phẩm sơn dầu</h2>
            </div>
            <div class="product-canvas"></div>
         </div>
         <div class="product-cakes-container">
            <div class="header-section">
               <h2 class="title">Sản phẩm Bánh</h2>
            </div>
            <div class="product-cakes"></div>
         </div>
      </main>
      <footer></footer>
   </body>
   <script src="assets/js/layout.js"></script>
   <script type="module">
      import { products } from "./assets/data/products-home/products.js";

      const slides = document.querySelectorAll(".slide");
      const dots = document.querySelectorAll(".slider-dot");
      const prevBtn = document.querySelector(".slider-arrow.prev");
      const nextBtn = document.querySelector(".slider-arrow.next");
      let currentSlide = 0;
      let slideInterval;

      function showSlide(n) {
         slides[currentSlide].classList.remove("active");
         dots[currentSlide].classList.remove("active");

         currentSlide = (n + slides.length) % slides.length;

         slides[currentSlide].classList.add("active");
         dots[currentSlide].classList.add("active");
      }

      function nextSlide() {
         showSlide(currentSlide + 1);
      }

      function prevSlide() {
         showSlide(currentSlide - 1);
      }

      function startSlideShow() {
         slideInterval = setInterval(nextSlide, 5000);
      }

      function stopSlideShow() {
         clearInterval(slideInterval);
      }

      nextBtn.addEventListener("click", () => {
         nextSlide();
         stopSlideShow();
         startSlideShow();
      });

      prevBtn.addEventListener("click", () => {
         prevSlide();
         stopSlideShow();
         startSlideShow();
      });

      dots.forEach((dot, index) => {
         dot.addEventListener("click", () => {
            showSlide(index);
            stopSlideShow();
            startSlideShow();
         });
      });
      startSlideShow();
      document
         .querySelector(".hero")
         .addEventListener("mouseenter", stopSlideShow);
      document
         .querySelector(".hero")
         .addEventListener("mouseleave", startSlideShow);
      const createSlug = (str) => {
         return str
            .toLowerCase()
            .normalize("NFD")
            .replace(/[\u0300-\u036f]/g, "")
            .replace(/[đĐ]/g, "d")
            .replace(/[^a-z0-9]+/g, "-")
            .replace(/(^-|-$)+/g, "");
      };

      // Render sản phẩm may (sewing)
      const renderProducts = () => {
         const list = document.querySelector(".product-grid");
         if (!list) return;

         const productsHTML = products.sewing
            .map((p) => {
               const slug = createSlug(p.product_name);
               const detailURL = `pages/detail-product.html?id=${p.id}&category=sewing&name=${slug}`;

               return `
            <div class="product-card" data-url="${detailURL}" style="cursor: pointer;">
                <div class="product-image-placeholder">
                    <img src=\assets/img/products-home/${p.img}\ alt="${
                  p.product_name
               }">
                </div>
                <div class="product-info">
                    <p class="product-name">${p.product_name}</p>
                    <p class="product-description">${p.description}</p>
                    <p class="product-material">Chất liệu: ${p.material}</p>
                    <div class="price-and-cart">
                        <span class="price">${p.price_range.toLocaleString(
                           "vi-VN"
                        )}₫</span>
                       <button class="cart-icon-btn" aria-label="Thêm vào giỏ hàng" onclick="event.stopPropagation()">
  <i class="fa-solid fa-cart-shopping"></i>
</button>
                    </div>
                </div>
            </div>`;
            })
            .join("");

         list.innerHTML = productsHTML;

         // Thêm sự kiện click cho từng card
         document.querySelectorAll(".product-card").forEach((card) => {
            card.addEventListener("click", (e) => {
               // Ngăn click nút giỏ hàng cũng chuyển trang
               if (e.target.closest(".cart-icon-btn")) return;

               const url = card.getAttribute("data-url");
               window.location.href = url;
            });
         });
      };

      const renderProductsCanva = () => {
         const list = document.querySelector(".product-canvas");
         if (!list) return;

         const productsHTML = products.canvas
            .map((p) => {
               const slug = createSlug(p.product_name);
               const detailURL = `pages/detail-product.html?id=${p.id}&category=canvas&name=${slug}`;

               return `
            <div class="product-card" data-url="${detailURL}" style="cursor: pointer;">
                <div class="product-image-placeholder">
                  <img src=\assets/img/products-home/${p.img}\  alt="${
                  p.product_name
               }">
                </div>
                <div class="product-info">
                   <p class="product-name">${p.product_name}</p>
                   <p class="product-description">${p.description}</p>
                   <p class="product-material">Tác giả: ${p.author}</p>
                   <div class="price-and-cart">
                      <span class="price">${p.price_range.toLocaleString(
                         "vi-VN"
                      )}₫</span>
                     <button class="cart-icon-btn" aria-label="Thêm vào giỏ hàng" onclick="event.stopPropagation()">
  <i class="fa-solid fa-cart-shopping"></i>
</button>
                   </div>
                </div>
            </div>`;
            })
            .join("");

         list.innerHTML = productsHTML;
         addCardClickListeners();
      };

      const renderProductsCakes = () => {
         const list = document.querySelector(".product-cakes");
         if (!list) return;

         const productsHTML = products.cakes
            .map((p) => {
               const slug = createSlug(p.product_name);
               const detailURL = `pages/detail-product.html?id=${p.id}&category=cakes&name=${slug}`;
               return `
            <div class="product-card" data-url="${detailURL}" style="cursor: pointer;">
                <div class="product-image-placeholder">
                  <img src=\assets/img/products-home/${p.img}\ alt="${
                  p.product_name
               }">
                </div>
                <div class="product-info">
                   <p class="product-name">${p.product_name}</p>
                   <p class="product-description">${p.description}</p>
                   <div class="price-and-cart">
                      <span class="price">${p.price_range.toLocaleString(
                         "vi-VN"
                      )}₫</span>
                      <button class="cart-icon-btn" aria-label="Thêm vào giỏ hàng" onclick="event.stopPropagation()">
  <i class="fa-solid fa-cart-shopping"></i>
</button>
                   </div>
                </div>
            </div>`;
            })
            .join("");

         list.innerHTML = productsHTML;
         addCardClickListeners();
      };

      // Hàm chung thêm sự kiện click
      function addCardClickListeners() {
         document.querySelectorAll(".product-card").forEach((card) => {
            card.addEventListener("click", (e) => {
               if (e.target.closest(".cart-icon-btn")) return;
               const url = card.getAttribute("data-url");
               window.location.href = url;
            });
         });
      }
      document.addEventListener("DOMContentLoaded", () => {
         renderProducts();
         renderProductsCanva();
         renderProductsCakes();
      });
   </script>
</html>
